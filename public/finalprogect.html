<!DOCTYPE html>
<html>
<head>
<title>Labirinto</title>
</head>
<body id="myBody" style="background-repeat:repeat; background-size: 80%; margin: 0;" background="myBackground01.jpg">
<h1 align="center"><font color="red">T4A04 Maze by Fred</font></h1>

<div style="text-align: center; padding: 10px;">
<input type="button" value="Left" onclick="movePlayer(-10, 0)">
<input type="button" value="Up" onclick="movePlayer(0, -10)">
<input type="button" value="Down" onclick="movePlayer(0, 10)">
<input type="button" value="Right" onclick="movePlayer(10, 0)">
</div>

<div style="position: relative; width: 900px; height: 600px; margin: 20px auto;">
  <canvas id="mazeCanvas" width="900" height="600" style="position: absolute; opacity: 0;"></canvas>
  <div id="player" style="position: absolute; width: 30px; height: 30px; left: 30px; top: 30px; background-color: blue; border: 2px solid darkblue; border-radius: 5px; z-index: 3;"></div>
  <div id="goal" style="position: absolute; width: 50px; height: 50px; left: 820px; top: 520px; background-color: green; border: 3px solid darkgreen; border-radius: 5px; z-index: 2;"></div>
</div>

<script>
const canvas = document.getElementById('mazeCanvas');
const ctx = canvas.getContext('2d', { willReadFrequently: true });
const player = document.getElementById('player');
const goal = document.getElementById('goal');
const startX = 30, startY = 30;

// Carica immagine labirinto
const img = new Image();
img.onload = () => ctx.drawImage(img, 0, 0, 900, 600);
img.src = 'myBackground01.jpg';

// Controlla se tocca nero o colori scuri
function isOnBlack(x, y, w, h) {
  // Controlla TUTTI i pixel lungo i bordi del quadrato
  const points = [];
  
  // Bordo superiore (ogni 3 pixel)
  for (let i = 0; i <= w; i += 3) points.push([x+i, y]);
  // Bordo inferiore (ogni 3 pixel)
  for (let i = 0; i <= w; i += 3) points.push([x+i, y+h]);
  // Bordo sinistro (ogni 3 pixel)
  for (let i = 0; i <= h; i += 3) points.push([x, y+i]);
  // Bordo destro (ogni 3 pixel)
  for (let i = 0; i <= h; i += 3) points.push([x+w, y+i]);
  
  for (let [px, py] of points) {
    px = Math.floor(px);
    py = Math.floor(py);
    if (px >= 0 && px < 900 && py >= 0 && py < 600) {
      const pixel = ctx.getImageData(px, py, 1, 1).data;
      // Calcola la luminosità del pixel (media RGB)
      const brightness = (pixel[0] + pixel[1] + pixel[2]) / 3;
      // Considera muro se la luminosità è sotto 180 (molto più tollerante!)
      if (brightness < 180) return true;
    }
  }
  return false;
}

// Controlla vittoria
function checkGoal() {
  const pr = player.getBoundingClientRect();
  const gr = goal.getBoundingClientRect();
  if (!(pr.right < gr.left || pr.left > gr.right || pr.bottom < gr.top || pr.top > gr.bottom)) {
    alert('Hai Vinto!');
    player.style.left = startX + 'px';
    player.style.top = startY + 'px';
  }
}

// Muove giocatore
function movePlayer(dx, dy) {
  const x = parseInt(player.style.left) + dx;
  const y = parseInt(player.style.top) + dy;
  player.style.left = x + 'px';
  player.style.top = y + 'px';
  
  if (isOnBlack(x, y, 30, 30)) {
    player.style.left = startX + 'px';
    player.style.top = startY + 'px';
  }
  checkGoal();
}
</script>

</body>
</html>
