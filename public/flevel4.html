
<!DOCTYPE html>
<html>
<head>
<title>T4A04 Maze by Fred</title>
</head>

<body id="myBody" background="40 cells diameter theta maze.png" style="background-repeat: no-repeat; background-size: 900px 900px;">

<h1 align="right"><font color="red">T4A04 Maze gabri</font></h1>

<script>
   let myGlobalX = 0
   let myClock

   let myCanvas = document.createElement('canvas');
   let myCtx = myCanvas.getContext('2d');
   let myBackground = new Image();
   
   myBackground.src = '40 cells diameter theta maze.png'; 
   
   myBackground.onload = function() {
       myCanvas.width = 900;
       myCanvas.height = 900;
       myCtx.drawImage(myBackground, 0, 0, 900, 900);
   };

   function myCheckHit(){
       let player = document.getElementById('myImage01.jpg');
       let x = parseInt(player.style.left) + 20; 
       let y = parseInt(player.style.top) + 20; 

       try {
           let pixel = myCtx.getImageData(x, y, 1, 1).data;
           let brightness = pixel[0] + pixel[1] + pixel[2];

           if (brightness < 100) { 
               console.log('Hai toccato un muro!');
               player.style.left = '5px';
               player.style.top = '455px';
           }
           
       } catch(error) {
           console.log('Sicurezza Browser (CORS): Impossibile leggere i colori in locale.');
       }
   }

   function myHitOther(my1,my2){
       let left1   = parseInt(document.getElementById(my1).style.left)
       let right1  = left1 + parseInt(document.getElementById(my1).style.width)
       let top1    = parseInt(document.getElementById(my1).style.top)   
       let bottom1 = top1   + parseInt(document.getElementById(my1).style.height)
       let left2   = parseInt(document.getElementById(my2).style.left)
       let right2  = left2 + parseInt(document.getElementById(my2).style.width)
       let top2    = parseInt(document.getElementById(my2).style.top)   
       let bottom2 = top2   + parseInt(document.getElementById(my2).style.height)
       
       if ((right1  >=  left2  ) &&      	   
           (bottom1 >=  top2   ) &&
           (left1   <=  right2 ) &&
           (top1    <=  bottom2) ){
           return true
       }
   }

function myMove(dir) {
       let myImg = document.getElementById('myImage01.jpg');
       let steps = 5; 

       for (let i = 0; i < steps; i++) {
           let currentLeft = parseInt(myImg.style.left);
           let currentTop = parseInt(myImg.style.top);

           if (dir == 'right') {
               myImg.style.left = (currentLeft + 1) + 'px';
           }
           if (dir == 'left') {
               myImg.style.left = (currentLeft - 1) + 'px';
           }
           if (dir == 'up') {
               myImg.style.top = (currentTop - 1) + 'px';
           }
           if (dir == 'down') {
               myImg.style.top = (currentTop + 1) + 'px';
           }

           if (myCheckHit()) {
               break; 
           }

           if (myHitOther('myImage01.jpg','myImg04')) {
               alert('You Win, now go to the next level');
               myImg.style.left = '5px';
               myImg.style.top = '455px';
               location = 'https://gdb27.github.io/game-dev-file-2025/public/finalprogectlevel2.html';
               break;
           }
       }
   }


   document.addEventListener('keydown', function(event) {
       let key = event.key.toLowerCase();
       
       if (key == 'w') {
           myMove('up');
       }
       else if (key == 'a') {
           myMove('left');
       }
       else if (key == 's') {
           myMove('down');
       }
       else if (key == 'd') {
           myMove('right');
       }
   });
</script>

<div align="right">
    <input type="button" value="Up(W)" ontouchstart="{myMove('up'); event.preventDefault();}" onclick="myMove('up')">
    <br>
    <input type="button" value="Left(A)" ontouchstart="{myMove('left'); event.preventDefault();}" onclick="myMove('left')">
    <input type="button" value="Right(D)" ontouchstart="{myMove('right'); event.preventDefault();}" onclick="myMove('right')">
    <br>
    <input type="button" value="Down(S)" ontouchstart="{myMove('down'); event.preventDefault();}" onclick="myMove('down')">
</div>

<br><br>

<img id="myImage01.jpg" src="myImage01.jpg" style="position:absolute; width:30px; height:30px; left:5px; top:455px; z-index: 10;">

<img id="myImg04" src="myImage02.jpg" style="position:absolute; width:50px; height:50px; left:1510px; top:405px; opacity: 0.5;">
</body>
</html>
