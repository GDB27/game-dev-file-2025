<!DOCTYPE html>
<html>
<head>
<title>Labirinto</title>
</head>
<body id="myBody" style="background-repeat:repeat; background-size: 80%; margin: 0;" background="myBackground01.jpg">
<h1 align="center"><font color="red">T4A04 Maze by Fred</font></h1>

<div style="text-align: center; padding: 10px;">
<input type="button" value="Left" onclick="movePlayer(-10, 0)">
<input type="button" value="Up" onclick="movePlayer(0, -10)">
<input type="button" value="Down" onclick="movePlayer(0, 10)">
<input type="button" value="Right" onclick="movePlayer(10, 0)">
</div>

<div style="position: relative; width: 900px; height: 600px; margin: 20px auto;">
  <canvas id="mazeCanvas" width="900" height="600" style="position: absolute; opacity: 0;"></canvas>
  <div id="player" style="position: absolute; width: 30px; height: 30px; left: 30px; top: 30px; background-color: blue; border: 2px solid darkblue; border-radius: 5px; z-index: 3;"></div>
  <div id="goal" style="position: absolute; width: 50px; height: 50px; left: 820px; top: 520px; background-color: green; border: 3px solid darkgreen; border-radius: 5px; z-index: 2;"></div>
</div>

<script>
const canvas = document.getElementById('mazeCanvas');
const ctx = canvas.getContext('2d', { willReadFrequently: true });
const player = document.getElementById('player');
const goal = document.getElementById('goal');
const startX = 30, startY = 30;

// Carica immagine labirinto
const img = new Image();
img.onload = () => ctx.drawImage(img, 0, 0, 900, 600);
img.src = 'myBackground01.jpg';

// Controlla se tocca nero
function isOnBlack(x, y, w, h) {
  // Controlla molti piÃ¹ punti: angoli, bordi e centro
  const points = [
    // Angoli
    [x, y], [x+w, y], [x, y+h], [x+w, y+h],
    // Bordi superiore e inferiore
    [x+w/4, y], [x+w/2, y], [x+3*w/4, y],
    [x+w/4, y+h], [x+w/2, y+h], [x+3*w/4, y+h],
    // Bordi sinistro e destro
    [x, y+h/4], [x, y+h/2], [x, y+3*h/4],
    [x+w, y+h/4], [x+w, y+h/2], [x+w, y+3*h/4],
    // Centro
    [x+w/2, y+h/2]
  ];
  
  for (let [px, py] of points) {
    px = Math.floor(px);
    py = Math.floor(py);
    if (px >= 0 && px < 900 && py >= 0 && py < 600) {
      const pixel = ctx.getImageData(px, py, 1, 1).data;
      // Tolleranza aumentata: considera nero se RGB < 100 (invece di 50)
      if (pixel[0] < 100 && pixel[1] < 100 && pixel[2] < 100) return true;
    }
  }
  return false;
}

// Controlla vittoria
function checkGoal() {
  const pr = player.getBoundingClientRect();
  const gr = goal.getBoundingClientRect();
  if (!(pr.right < gr.left || pr.left > gr.right || pr.bottom < gr.top || pr.top > gr.bottom)) {
    alert('Hai Vinto!');
    player.style.left = startX + 'px';
    player.style.top = startY + 'px';
  }
}

// Muove giocatore
function movePlayer(dx, dy) {
  const x = parseInt(player.style.left) + dx;
  const y = parseInt(player.style.top) + dy;
  player.style.left = x + 'px';
  player.style.top = y + 'px';
  
  if (isOnBlack(x, y, 30, 30)) {
    player.style.left = startX + 'px';
    player.style.top = startY + 'px';
  }
  checkGoal();
}
</script>

</body>
</html>
