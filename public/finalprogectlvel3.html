<!DOCTYPE html>
<html>
<head>
<title>T4A04 Maze by Fred</title>
</head>

<body id="myBody" background="20 by 30 orthogonal maze.png" style="background-repeat: no-repeat; background-size: 1500px 1000px;">

<h1 align="center"><font color="red">T4A04 Maze by Fred (Pixel Version)</font></h1>

<script>
   let myGlobalX = 0
   let myClock

   let myCanvas = document.createElement('canvas');
   let myCtx = myCanvas.getContext('2d');
   let myBackground = new Image();
   
   myBackground.src = '20 by 30 orthogonal maze.png'; 
   
   myBackground.onload = function() {
       myCanvas.width = 1500;
       myCanvas.height = 1000;
       myCtx.drawImage(myBackground, 0, 0, 1500, 1000);
   };

   function myCheckHit(){
       let player = document.getElementById('myImage01.jpg');
       let x = parseInt(player.style.left) + 20; 
       let y = parseInt(player.style.top) + 20; 

       try {
           let pixel = myCtx.getImageData(x, y, 1, 1).data;
           let brightness = pixel[0] + pixel[1] + pixel[2];

           if (brightness < 100) { 
               console.log('Hai toccato un muro!');
               player.style.left = '50px';
               player.style.top = '190px';
           }
           
       } catch(error) {
           console.log('Sicurezza Browser (CORS): Impossibile leggere i colori in locale.');
       }
   }

   function myHitOther(my1,my2){
       let left1   = parseInt(document.getElementById(my1).style.left)
       let right1  = left1 + parseInt(document.getElementById(my1).style.width)
       let top1    = parseInt(document.getElementById(my1).style.top)   
       let bottom1 = top1   + parseInt(document.getElementById(my1).style.height)
       let left2   = parseInt(document.getElementById(my2).style.left)
       let right2  = left2 + parseInt(document.getElementById(my2).style.width)
       let top2    = parseInt(document.getElementById(my2).style.top)   
       let bottom2 = top2   + parseInt(document.getElementById(my2).style.height)
       
       if ((right1  >=  left2  ) &&      	   
           (bottom1 >=  top2   ) &&
           (left1   <=  right2 ) &&
           (top1    <=  bottom2) ){
           return true
       }
   }

   function myMove(dir) {
       let myImg = document.getElementById('myImage01.jpg');
       let currentLeft = parseInt(myImg.style.left);
       let currentTop = parseInt(myImg.style.top);

       if (dir == 'right') {
           myImg.style.left = (currentLeft + 10) + 'px';
       }
       if (dir == 'left') {
           myImg.style.left = (currentLeft - 10) + 'px';
       }
       if (dir == 'up') {
           myImg.style.top = (currentTop - 10) + 'px';
       }
       if (dir == 'down') {
           myImg.style.top = (currentTop + 10) + 'px';
       }

       myCheckHit();
       
       // CONTROLLO VITTORIA - ORA FUNZIONA!
       if (myHitOther('myImage01.jpg','myImg04')) {
           alert('You Win, now go to the next level');
           myImg.style.left = '50px';
           myImg.style.top = '190px';
           location = 'https://gdb27.github.io/game-dev-file-2025/public/finalprogectlevel2.html';
       }
   }

   document.addEventListener('keydown', function(event) {
       let key = event.key.toLowerCase();
       
       if (key == 'w') {
           myMove('up');
       }
       else if (key == 'a') {
           myMove('left');
       }
       else if (key == 's') {
           myMove('down');
       }
       else if (key == 'd') {
           myMove('right');
       }
   });
</script>

<div align="center">
    <input type="button" value="Up" ontouchstart="{myMove('up'); event.preventDefault();}" onclick="myMove('up')">
    <br>
    <input type="button" value="Left" ontouchstart="{myMove('left'); event.preventDefault();}" onclick="myMove('left')">
    <input type="button" value="Right" ontouchstart="{myMove('right'); event.preventDefault();}" onclick="myMove('right')">
    <br>
    <input type="button" value="Down" ontouchstart="{myMove('down'); event.preventDefault();}" onclick="myMove('down')">
</div>

<br><br>

<img id="myImage01.jpg" src="myImage01.jpg" style="position:absolute; width:30px; height:30px; left:50px; top:190px; z-index: 10;">

<img id="myImg04" src="myImage02.jpg" style="position:absolute; width:50px; height:50px; left:880px; top:800px; opacity: 0.5;">

</body>
</html>
